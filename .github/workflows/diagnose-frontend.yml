name: ğŸ” Diagnose Frontend Issues

on:
  workflow_dispatch:

jobs:
  diagnose:
    name: ğŸ” Frontend Diagnostics
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ” System Information
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USERNAME }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: ${{ secrets.VPS_PORT }}
          command_timeout: 10m
          script: |
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "ğŸ” SYSTEM DIAGNOSTICS"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            
            echo ""
            echo "ğŸ“¦ Node.js & NPM:"
            node --version
            npm --version
            
            echo ""
            echo "ğŸ’¾ Disk Space:"
            df -h /root
            
            echo ""
            echo "ğŸ§  Memory:"
            free -h
            
            echo ""
            echo "ğŸ“‚ Frontend Directory Structure:"
            ls -la /root/neuroviabot/bot/neuroviabot-frontend/ || echo "Directory not found!"
            
            echo ""
            echo "ğŸ“‹ package.json exists:"
            if [ -f "/root/neuroviabot/bot/neuroviabot-frontend/package.json" ]; then
              echo "âœ… package.json found"
              cat /root/neuroviabot/bot/neuroviabot-frontend/package.json | grep -A 5 "\"dependencies\""
            else
              echo "âŒ package.json NOT FOUND"
            fi
            
            echo ""
            echo "ğŸ” node_modules status:"
            if [ -d "/root/neuroviabot/bot/neuroviabot-frontend/node_modules" ]; then
              echo "âœ… node_modules exists"
              echo "ğŸ“Š node_modules size: $(du -sh /root/neuroviabot/bot/neuroviabot-frontend/node_modules 2>/dev/null | cut -f1)"
              
              if [ -d "/root/neuroviabot/bot/neuroviabot-frontend/node_modules/next" ]; then
                echo "âœ… next package exists"
              else
                echo "âŒ next package NOT FOUND"
              fi
              
              if [ -f "/root/neuroviabot/bot/neuroviabot-frontend/node_modules/.bin/next" ]; then
                echo "âœ… next binary exists"
              else
                echo "âŒ next binary NOT FOUND"
              fi
            else
              echo "âŒ node_modules does NOT exist"
            fi
            
            echo ""
            echo "ğŸ—ï¸ Build directory status:"
            if [ -d "/root/neuroviabot/bot/neuroviabot-frontend/.next" ]; then
              echo "âœ… .next directory exists"
              echo "ğŸ“Š .next size: $(du -sh /root/neuroviabot/bot/neuroviabot-frontend/.next 2>/dev/null | cut -f1)"
            else
              echo "âŒ .next directory does NOT exist"
            fi
            
            echo ""
            echo "ğŸ“‹ PM2 Status:"
            pm2 list
            
            echo ""
            echo "ğŸ” PM2 Config:"
            if [ -f "/root/neuroviabot/bot/PM2-ECOSYSTEM.config.js" ]; then
              echo "âœ… PM2 config exists"
              cat /root/neuroviabot/bot/PM2-ECOSYSTEM.config.js | grep -A 20 "neuroviabot-frontend"
            else
              echo "âŒ PM2 config NOT FOUND"
            fi
            
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "âœ… DIAGNOSTICS COMPLETED"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
